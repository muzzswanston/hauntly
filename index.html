<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ghost Map Files</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{height:100%;width:100%;font-family:'Georgia',serif;background:linear-gradient(135deg,#0a0a0a 0%,#1a1a2e 100%);color:#e0d8c3;overflow:hidden;}
    header{background:linear-gradient(135deg,#1a1a1a 0%,#2d1b69 100%);padding:1.5rem;text-align:center;border-bottom:3px double #ff6b6b;box-shadow:0 4px 20px rgba(255,107,107,0.2);}
    h1{font-size:2.2rem;color:#ff6b6b;text-shadow:0 0 15px #ff6b6b;margin:0;font-weight:bold;}
    .subtitle{font-size:1.1rem;color:#b8a07e;margin:0.5rem 0;}
    #controls{display:flex;justify-content:center;flex-wrap:wrap;gap:1rem;margin-top:1rem;}
    button{background:linear-gradient(135deg,#ff6b6b 0%,#ff8e8e 100%);color:#fff;border:none;padding:0.8rem 1.8rem;border-radius:25px;cursor:pointer;font-weight:bold;font-size:1rem;box-shadow:0 4px 15px rgba(255,107,107,0.3);transition:all 0.3s ease;}
    button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,107,107,0.4);}
    #leyToggle{background:#8B4513;}
    #map{height:calc(100vh - 160px);width:100%;}
    footer{text-align:center;padding:1rem;background:linear-gradient(135deg,#1a1a1a 0%,#2d1b69 100%);color:#8c7a5e;border-top:3px double #ff6b6b;font-size:0.95rem;}
    .book-btn{background:linear-gradient(135deg,#ff4500 0%,#ff6b35 100%)!important;width:100%!important;margin-top:10px!important;}
    @media(max-width:768px){h1{font-size:1.8rem;}#map{height:calc(100vh - 180px);}#controls{flex-direction:column;align-items:center;}}
  </style>
</head>
<body>
  <header>
    <h1>Ghost Map Files</h1>
    <p class="subtitle">45 Real Haunted Locations Worldwide</p>
    <div id="controls">
      <button onclick="centerOnUser()">Center on Me</button>
      <button id="leyToggle">Show Ley Lines</button>
    </div>
  </header>
  <div id="map"></div>
  <footer>Pins on the same ley line share color when ley lines are shown</footer>

  <script type="module">
    const API_KEY = import.meta.env?.VITE_GOOGLE_MAPS_API_KEY;
    if (!API_KEY) {
      document.body.innerHTML = '<div style="background:#000;color:#ff6b6b;text-align:center;padding:4rem;font-family:Georgia;"><h1 style="font-size:2.5rem;margin-bottom:1rem;">API Key Required</h1><p style="font-size:1.2rem;">Add <strong>VITE_GOOGLE_MAPS_API_KEY</strong> in Vercel → Settings → Environment Variables</p></div>';
    } else {
      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&callback=initMap&libraries=geometry`;
      script.async = true;
      document.head.appendChild(script);
    }
  </script>

  <script>
    let map, currentInfoWindow = null;
    let leyLines = [];
    let leyVisible = false;

    const leyLinePaths = [
      {path:[{lat:51.1789,lng:-1.8262},{lat:29.9792,lng:31.1342}],color:"#ff6b6b"},
      {path:[{lat:-25.3444,lng:131.0369},{lat:-13.1631,lng:-72.5450}],color:"#4ecdc4"},
      {path:[{lat:41.3095,lng:-122.3121},{lat:25,lng:-71}],color:"#45b7d1"},
      {path:[{lat:50.7306,lng:-1.4994},{lat:31.7683,lng:35.2137}],color:"#f9ca24"},
      {path:[{lat:35.6762,lng:139.6503},{lat:13.4125,lng:103.8669}],color:"#f0932b"},
      {path:[{lat:19.4326,lng:-99.1332},{lat:-27.1127,lng:-109.3497}],color:"#eb4d4b"},
      {path:[{lat:37.9838,lng:23.7275},{lat:27.1751,lng:78.0421}],color:"#6c5ce7"},
      {path:[{lat:-33.8568,lng:151.2153},{lat:-37.8136,lng:144.9631}],color:"#a29bfe"},
      {path:[{lat:40.7128,lng:-74.0060},{lat:48.8566,lng:2.3522}],color:"#fd79a8"},
      {path:[{lat:-33.4489,lng:-70.6693},{lat:-25.2637,lng:-57.5759}],color:"#55efc4"}
    ];

    const haunts = [
      ["New Orleans Ghost Tour",29.9584,-90.0651,"Ghost","French Quarter voodoo tour","https://www.viator.com/tours/New-Orleans/New-Orleans-Ghost-Voodoo-and-Vampire-Tour/d675-3780GT3"],
      ["Chicago Gangsters Tour",41.8781,-87.6298,"Ghost","Prohibition-era haunted sites","https://www.viator.com/tours/Chicago/Chicago-Crime-and-Mob-Tour/d673-6024CRIME"],
      ["NYC Greenwich Village Tour",40.7336,-73.9897,"Ghost","Haunted Greenwich Village walk","https://www.viator.com/tours/New-York-City/Greenwich-Village-Ghost-Tour/d687-6024GVGHOST"],
      ["Savannah Ghosts Tour",32.0809,-81.0912,"Ghost","Trolley tour of haunted sites","https://www.viator.com/tours/Savannah/Savannah-Ghosts-and-Gravestones-Trolley-Tour/d563-5919GHOST"],
      ["Gettysburg Ghost Tour",39.8309,-77.2311,"Ghost","Battlefield ghost hunt","https://www.viator.com/tours/Gettysburg/Gettysburg-Ghost-Tour/d22253-6024GETTYS"],
      ["San Antonio Ghost Walk",29.4241,-98.4936,"Ghost","River Walk haunted history","https://www.viator.com/tours/San-Antonio/San-Antonio-Ghost-Walk/d690-6024GHOST"],
      ["Boston Ghosts Tour",42.3601,-71.0589,"Ghost","Trolley tour of haunted sites","https://www.viator.com/tours/Boston/Boston-Ghosts-and-Gravestones-Tour/d678-6024GHOST"],
      ["Charleston Dungeon Tour",32.7765,-79.9311,"Ghost","Haunted dungeon walking tour","https://www.viator.com/tours/Charleston/Charleston-Ghost-and-Dungeon-Tour/d512-6024DUNGEON"],
      ["St Augustine Ghosts Tour",29.8919,-81.3145,"Ghost","America's oldest haunted city","https://www.viator.com/tours/St-Augustine/St-Augustine-Ghosts-and-Gravestones-Tour/d661-6024GHOST"],
      ["Salem Witch Tour",42.5195,-70.8967,"Ghost","Haunted witch trial history","https://www.viator.com/tours/Salem/Salem-Witch-Trials-Ghost-Tour/d231-6024SALEM"],
      ["Melbourne Ghost Tour",-37.8136,144.9631,"Ghost","Haunted Melbourne walking tour","https://www.viator.com/tours/Melbourne/Melbourne-Ghost-Tour/d384-6024MELBOURNE"],
      ["Castlemaine Gaol Tour",-37.0630,144.2170,"Ghost","Historic gaol ghost hunt","https://www.viator.com/tours/Victoria/Old-Castlemaine-Gaol-Ghost-Tour/d125-6024P5"],
      ["Altona Homestead Tour",-37.8670,144.8320,"Ghost","Haunted homestead evening tour","https://www.viator.com/tours/Victoria/Altona-Homestead-Ghost-Tour/d125-6024P15"],
      ["Aradale Asylum Tour",-37.2833,142.9333,"Ghost","Abandoned asylum investigation","https://www.viator.com/tours/Victoria/Aradale-Asylum-Ghost-Tour/d125-6024P4"],
      ["Old Melbourne Gaol Tour",-37.8128,144.9658,"Ghost","Ned Kelly's haunted prison","https://www.viator.com/tours/Melbourne/Old-Melbourne-Gaol-Night-Tour/d384-6024GAOL"],
      ["Port Arthur Ghost Tour",-43.1500,147.8500,"Ghost","Tasmania's haunted convict prison","https://www.viator.com/tours/Port-Arthur/Port-Arthur-Ghost-Tour/d32553-5774PAGT"],
      ["Pentridge Prison Tour",-37.7400,144.9700,"Ghost","Melbourne's infamous prison","https://www.viator.com/tours/Melbourne/Pentridge-Prison-Ghost-Tour/d384-6024PENTRIDGE"],
      ["Williamstown Ghost Tour",-37.8615,144.8980,"Ghost","Haunted pubs & gaol walk","https://www.viator.com/tours/Melbourne/Williamstown-Ghost-Tour/d384-6024WILLIAM"],
      ["Ballarat Ghost Tour",-37.5622,143.8503,"Ghost","Gold rush haunted tour","https://www.viator.com/tours/Ballarat/Ballarat-Ghost-Tour/d52558-6024BALLARAT"],
      ["J Ward Ghost Tour",-37.2833,142.9333,"Ghost","Ararat lunatic asylum tour","https://www.viator.com/tours/Victoria/J-Ward-Ghost-Tour/d125-6024JWARD"],
      ["Melbourne General Cemetery",-37.7867,144.9592,"Grave","5 Prime Ministers buried here"],
      ["St Kilda Cemetery",-37.8667,144.9833,"Grave","Victoria's oldest cemetery"],
      ["Coburg Pine Ridge Cemetery",-37.7429,144.9822,"Grave","Melbourne's first graveyard"],
      ["Fawkner Crematorium",-37.7667,144.9500,"Grave","Victoria's first crematorium"],
      ["Preston Cemetery",-37.7333,145.0000,"Grave","Founded 1864"],
      ["Heidelberg Cemetery",-37.7667,145.0333,"Grave","Established 1856"],
      ["Boroondara General Cemetery",-37.8037,145.0412,"Grave","Opened 1858 in Hawthorn"],
      ["Brighton General Cemetery",-37.9013,145.0207,"Grave","Laid out 1854"],
      ["Springvale Botanical Cemetery",-37.9388,145.1720,"Grave","Australia's largest cemetery"],
      ["Bunurong Memorial Park",-38.0648,145.2004,"Grave","Modern sanctuary opened 1994"],
      ["Berwick Cemetery",-38.0333,145.3500,"Grave","Rural burial ground since 1861"],
      ["Box Hill Cemetery",-37.8167,145.1200,"Grave","Historic site in Whitehorse"],
      ["Templestowe Cemetery",-37.7595,145.1417,"Grave","Established 1860"],
      ["Eltham Cemetery",-37.7266,145.1503,"Grave","Opened 1861"],
      ["Warrandyte Cemetery",-37.7333,145.2000,"Grave","Riverside graves since 1850s"],
      ["Lilydale Memorial Park",-37.7352,145.3425,"Grave","Yarra Ranges site since 1862"],
      ["Lilydale Lawn Cemetery",-37.7470,145.3384,"Grave","Modern companion cemetery"],
      ["Yarra Glen Cemetery",-37.6500,145.3833,"Grave","Small 1860s plot"],
      ["Healesville Cemetery",-37.6610,145.5281,"Grave","Bushland burial ground"],
      ["Woori Yallock Cemetery",-37.7833,145.5000,"Grave","Rural site from 1880s"],
      ["Cranbourne Cemetery",-38.1127,145.2720,"Grave","Historic Cranbourne cemetery"],
      ["Frankston Memorial Park",-38.1500,145.1333,"Grave","Coastal cemetery"],
      ["Geelong Memorial Park",-38.1500,144.3833,"Grave","Victoria's second-largest"],
      ["Torquay Cemetery",-38.3167,144.3167,"Grave","Bayside site since 1860s"],
      ["Barwon Heads Cemetery",-38.2833,144.4833,"Grave","Seaside graves from 1870s"]
    ];

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 3,
        center: { lat: 20, lng: 0 },
        styles: [
          {featureType: "all", elementType: "geometry", stylers: [{color: "#1a1a1a"}]},
          {featureType: "all", elementType: "labels.text.fill", stylers: [{color: "#746855"}]},
          {featureType: "road", elementType: "geometry", stylers: [{color: "#38414e"}]},
          {featureType: "water", elementType: "geometry", stylers: [{color: "#17263c"}]}
        ]
      });

      haunts.forEach(h => {
        const isCemetery = h[5] === "Grave";
        const baseColor = isCemetery ? "#999999" : (h[1] > 20 ? "#ff4545" : "#9458ff");
        const icon = {
          url: `data:image/svg+xml,\( {encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><circle cx="20" cy="20" r="18" fill=" \){baseColor}" stroke="#000" stroke-width="3"/><text x="20" y="25" font-size="16" text-anchor="middle" fill="#fff">${h[3]}</text></svg>`)}`,
          scaledSize: new google.maps.Size(40,40)
        };

        h.marker = new google.maps.Marker({position:{lat:h[1],lng:h[2]},map,title:h[0],icon});
        h.defaultIcon = icon;

        const content = `<div style="background:#1a1a2e;color:#e0d8c3;padding:15px;border:2px solid #ff6b6b;border-radius:12px;max-width:280px;">
          <h3 style="color:#ff6b6b;margin:0 0 8px 0;font-size:1.2rem;">\( {h[3]} \){h[0]}</h3>
          <p style="margin:8px 0;font-size:0.9rem;line-height:1.4;">${h[4]}</p>
          \( {!isCemetery && h[6] ? `<a href=" \){h[6]}" target="_blank" style="text-decoration:none;"><button class="book-btn">Book Tour</button></a>` : ''}
        </div>`;

        const iw = new google.maps.InfoWindow({content});
        h.marker.addListener("click", () => { if (currentInfoWindow) currentInfoWindow.close(); iw.open(map, h.marker); currentInfoWindow = iw; });
      });

      document.getElementById("leyToggle").onclick = () => {
        leyVisible = !leyVisible;
        document.getElementById("leyToggle").textContent = leyVisible ? "Hide Ley Lines" : "Show Ley Lines";
        if (leyVisible) {
          leyLinePaths.forEach((l,i) => {
            const line = new google.maps.Polyline({path:l.path,geodesic:true,strokeColor:l.color,strokeOpacity:0.6,strokeWeight:2,map});
            leyLines.push({line,index:i});
          });
        } else {
          leyLines.forEach(o => o.line.setMap(null));
          leyLines = [];
        }
        updateColors();
      };
    }

    function updateColors() {
      haunts.forEach(h => {
        if (!h.marker || h[5] === "Grave") return;
        if (!leyVisible) { h.marker.setIcon(h.defaultIcon); return; }

        let closest = {dist:Infinity,index:-1};
        const point = new google.maps.LatLng(h[1], h[2]);

        leyLinePaths.forEach((l,i) => {
          for (let j = 0; j < l.path.length-1; j++) {
            const p1 = new google.maps.LatLng(l.path[j].lat, l.path[j].lng);
            const p2 = new google.maps.LatLng(l.path[j+1].lat, l.path[j+1].lng);
            const proj = google.maps.geometry.spherical.interpolate(p1, p2, 
              google.maps.geometry.spherical.computeHeading(p1, point) / google.maps.geometry.spherical.computeHeading(p1, p2));
            const dist = google.maps.geometry.spherical.computeDistanceBetween(point, proj);
            if (dist < closest.dist) closest = {dist, index:i};
          }
        });

        if (closest.dist <= 5000 && closest.index !== -1) {
          const color = leyLinePaths[closest.index].color;
          h.marker.setIcon({
            url: `data:image/svg+xml,\( {encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><circle cx="20" cy="20" r="18" fill=" \){color}" stroke="#000" stroke-width="4"/><text x="20" y="25" font-size="16" text-anchor="middle" fill="#fff">Ghost</text></svg>`)}`,
            scaledSize: new google.maps.Size(40,40)
          });
        } else h.marker.setIcon(h.defaultIcon);
      });
    }

    function centerOnUser(){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          map.setCenter({lat:pos.coords.latitude,lng:pos.coords.longitude});
          map.setZoom(12);
        },()=>{alert("Location access denied");});
      }else{alert("Geolocation not supported");}
    }
  </script>
</body>
</html>
